<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智慧农业控制面板</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* 全局样式和字体 (玻璃拟物化主题) */
        :root {
            --bg-url: url('https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2074&q=80');
            --card-bg-color: rgba(255, 255, 255, 0.1);
            --border-color: rgba(255, 255, 255, 0.2);
            --text-color: #f0f0f0;
            --text-secondary-color: #b0b0b0;
            --success-color: #00ffab;
            --sun-color: #ffeb3b;
            --moon-color: #e0e0e0;
            --font-family: 'Poppins', sans-serif;
        }
        body {
            font-family: var(--font-family);
            background: var(--bg-url) no-repeat center center fixed;
            background-size: cover;
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .container {
            width: 100%;
            max-width: 420px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            box-sizing: border-box;
        }

        /* 顶部天空和太阳动画 */
        .sky-container {
            position: relative;
            height: 100px;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            transition: background 1s ease;
        }
        #sun {
            position: absolute;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            /* 添加了 opacity 过渡效果 */
            transition: transform 1s linear, background-color 1s ease, box-shadow 1s ease, opacity 1s ease;
        }

        /* 顶部信息栏 */
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .header h1 {
            margin: 0 0 0.25rem 0;
            font-size: 2rem;
            font-weight: 700;
        }
        #time-display {
            font-size: 1rem;
            font-weight: 300;
            color: var(--text-secondary-color);
            letter-spacing: 2px;
        }

        /* 数据显示区域 */
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .data-card {
            background: var(--card-bg-color);
            border-radius: 16px;
            padding: 1.5rem 1rem;
            text-align: center;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .data-card .value {
            font-size: 2.2rem;
            font-weight: 600;
            margin: 0.25rem 0;
            line-height: 1.2;
        }
        .data-card .label {
            font-size: 0.8rem;
            font-weight: 300;
            color: var(--text-secondary-color);
        }

        /* 控制器区域 */
        .controls-container {
            background: var(--card-bg-color);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .control-row h2 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 400;
            flex-grow: 1;
        }
        .control-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* 开关样式 */
        .toggle-switch {
            position: relative; display: inline-block;
            width: 50px; height: 28px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.3);
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute; content: "";
            height: 20px; width: 20px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--success-color); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* 设置按钮 (SVG Icon) */
        .settings-btn {
            background: none; border: none;
            color: var(--text-secondary-color);
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .settings-btn:hover {
            color: var(--text-color);
            transform: rotate(45deg);
        }
        .settings-btn svg { width: 24px; height: 24px; }

        /* 弹窗 (Modal) 样式 */
        .modal {
            display: none; position: fixed; z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 2rem; border-radius: 16px;
            border: 1px solid var(--border-color);
            width: 90%; max-width: 350px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 1.5rem;
        }
        .modal-header h2 { margin: 0; font-weight: 600; }
        .close-btn { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-body .form-group { margin-bottom: 1rem; }
        .modal-body label { display: block; margin-bottom: 0.5rem; font-weight: 300; }
        .modal-body input[type="time"] {
            width: 100%; padding: 0.8rem; border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: rgba(0,0,0,0.3);
            color: var(--text-color); font-size: 1rem; box-sizing: border-box;
        }
        .modal-footer { text-align: right; margin-top: 1.5rem; }
        .save-btn {
            background-color: var(--success-color); color: #111;
            padding: 0.7rem 1.5rem; border: none; border-radius: 8px;
            cursor: pointer; font-size: 1rem; font-weight: 600;
        }
        .sprinkler-level-setter {
            display: flex; justify-content: space-around; align-items: center;
            padding: 1rem 0;
        }
        .level-option {
            width: 50px; height: 50px; border-radius: 50%;
            background-color: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; font-weight: bold;
            cursor: pointer; transition: all 0.3s;
        }
        .level-option.active {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: #111;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="sky-container" id="sky">
            <div id="sun"></div>
        </div>

        <header class="header">
            <h1>智慧农场</h1>
            <div id="time-display">--:--:--</div>
        </header>

        <section class="data-grid">
            <div class="data-card">
                <div class="value" id="temperature-display">--°C</div>
                <div class="label">环境温度</div>
            </div>
            <div class="data-card">
                <div class="value" id="humidity-display">--%</div>
                <div class="label">空气湿度</div>
            </div>
        </section>

        <section class="controls-container">
            <div class="control-row">
                <h2>补光灯</h2>
                <div class="control-actions">
                    <label class="toggle-switch">
                        <input type="checkbox" id="light-toggle">
                        <span class="slider"></span>
                    </label>
                    <button class="settings-btn" id="light-settings-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    </button>
                </div>
            </div>
            <div class="control-row">
                <h2>洒水器</h2>
                <div class="control-actions">
                    <label class="toggle-switch">
                        <input type="checkbox" id="sprinkler-toggle">
                        <span class="slider"></span>
                    </label>
                    <button class="settings-btn" id="sprinkler-settings-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Modals -->
    <div id="light-settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>补光灯定时设置</h2>
                <span class="close-btn" data-modal-id="light-settings-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="start-time">开启时间:</label>
                    <input type="time" id="start-time">
                </div>
                <div class="form-group">
                    <label for="end-time">关闭时间:</label>
                    <input type="time" id="end-time">
                </div>
            </div>
            <div class="modal-footer">
                <button class="save-btn" data-modal-id="light-settings-modal">保存</button>
            </div>
        </div>
    </div>

    <div id="sprinkler-settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>洒水器强度设置</h2>
                <span class="close-btn" data-modal-id="sprinkler-settings-modal">&times;</span>
            </div>
            <div class="modal-body">
                <label>选择喷洒强度:</label>
                <div class="sprinkler-level-setter">
                    <div class="level-option" data-level="1">1</div>
                    <div class="level-option" data-level="2">2</div>
                    <div class="level-option" data-level="3">3</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const timeDisplay = document.getElementById('time-display');
            const tempDisplay = document.getElementById('temperature-display');
            const humidityDisplay = document.getElementById('humidity-display');
            const sun = document.getElementById('sun');
            const sky = document.getElementById('sky');
            const lightToggle = document.getElementById('light-toggle');
            const sprinklerToggle = document.getElementById('sprinkler-toggle');
            const lightSettingsModal = document.getElementById('light-settings-modal');
            const lightSettingsBtn = document.getElementById('light-settings-btn');
            const startTimeInput = document.getElementById('start-time');
            const endTimeInput = document.getElementById('end-time');
            const sprinklerSettingsModal = document.getElementById('sprinkler-settings-modal');
            const sprinklerSettingsBtn = document.getElementById('sprinkler-settings-btn');
            const levelOptions = document.querySelectorAll('.level-option');

            // --- Default Settings ---
            const defaultSettings = {
                lightOn: false,
                sprinklerOn: false,
                sprinklerLevel: 1,
                lightStartTime: '18:00',
                lightEndTime: '06:00'
            };
            let settings = {};

            // --- Functions ---
            function loadSettings() {
                const savedSettings = localStorage.getItem('smartAgriSettingsV2');
                settings = savedSettings ? JSON.parse(savedSettings) : { ...defaultSettings };
                updateUIFromSettings();
            }

            function saveSettings() {
                localStorage.setItem('smartAgriSettingsV2', JSON.stringify(settings));
            }

            function updateUIFromSettings() {
                lightToggle.checked = settings.lightOn;
                sprinklerToggle.checked = settings.sprinklerOn;
                startTimeInput.value = settings.lightStartTime;
                endTimeInput.value = settings.lightEndTime;
                updateSprinklerLevelUI();
            }
            
            function updateSprinklerLevelUI() {
                levelOptions.forEach(opt => {
                    opt.classList.toggle('active', parseInt(opt.dataset.level) === settings.sprinklerLevel);
                });
            }

            function updateTimeAndSun() {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const seconds = now.getSeconds();
                timeDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                
                const totalMinutes = hours * 60 + minutes;
                // 定义日出日落时间 (6 AM to 6 PM)
                const sunrise = 6 * 60; 
                const sunset = 18 * 60;

                if (totalMinutes >= sunrise && totalMinutes <= sunset) {
                    // --- 白天 ---
                    sun.style.opacity = '1'; // 让太阳可见

                    const dayDuration = sunset - sunrise;
                    const minutesIntoDay = totalMinutes - sunrise;
                    const dayPercentage = minutesIntoDay / dayDuration; // 范围: 0.0 to 1.0

                    // X 坐标: 从左到右线性移动 (5% -> 95%)
                    const x = (sky.offsetWidth * 0.90) * dayPercentage + (sky.offsetWidth * 0.05);

                    // Y 坐标: 一个平缓的弧线, 中午最高
                    const arc = Math.sin(dayPercentage * Math.PI); // 产生 0 -> 1 -> 0 的曲线
                    const y = (sky.offsetHeight * 0.7) - (arc * sky.offsetHeight * 0.5);

                    sun.style.transform = `translate(${x - 14}px, ${y - 14}px)`;
                    sun.style.backgroundColor = 'var(--sun-color)';
                    sun.style.boxShadow = `0 0 20px 5px var(--sun-color)`;

                    // 天空背景渐变
                    const noonFactor = 1 - Math.abs(dayPercentage - 0.5) * 2;
                    const blue = 135 + 70 * noonFactor;
                    const orange = 218 - 60 * noonFactor;
                    sky.style.background = `linear-gradient(to bottom, rgb(135, 206, 235), rgb(255, ${orange}, ${blue}))`;

                } else {
                    // --- 夜晚 ---
                    sun.style.opacity = '0'; // 隐藏太阳
                    sky.style.background = '#000000'; // 天空背景变为黑色
                }
            }

            function simulateDataUpdate() {
                const fakeTemp = (25 + Math.random() * 2 - 1).toFixed(1);
                const fakeHumidity = (60 + Math.random() * 10 - 5).toFixed(0);
                tempDisplay.textContent = `${fakeTemp}°C`;
                humidityDisplay.textContent = `${fakeHumidity}%`;
            }

            // --- Event Listeners ---
            lightToggle.addEventListener('change', () => {
                settings.lightOn = lightToggle.checked;
                saveSettings();
            });

            sprinklerToggle.addEventListener('change', () => {
                settings.sprinklerOn = sprinklerToggle.checked;
                saveSettings();
            });

            function openModal(modal) { modal.style.display = 'flex'; }
            function closeModal(modal) { modal.style.display = 'none'; }

            lightSettingsBtn.addEventListener('click', () => openModal(lightSettingsModal));
            sprinklerSettingsBtn.addEventListener('click', () => openModal(sprinklerSettingsModal));

            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => closeModal(document.getElementById(btn.dataset.modalId)));
            });
            
            document.querySelectorAll('.save-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.dataset.modalId === 'light-settings-modal') {
                        settings.lightStartTime = startTimeInput.value;
                        settings.lightEndTime = endTimeInput.value;
                        saveSettings();
                    }
                    closeModal(document.getElementById(btn.dataset.modalId));
                });
            });
            
            window.addEventListener('click', (event) => {
                if (event.target.classList.contains('modal')) {
                    closeModal(event.target);
                }
            });

            levelOptions.forEach(opt => {
                opt.addEventListener('click', () => {
                    settings.sprinklerLevel = parseInt(opt.dataset.level);
                    updateSprinklerLevelUI();
                    saveSettings();
                });
            });

            // --- Initialization ---
            loadSettings();
            // 首次加载时延迟一点再执行，确保 sky.offsetWidth 能正确获取
            setTimeout(() => {
                updateTimeAndSun();
                setInterval(updateTimeAndSun, 1000); // 然后每秒更新
            }, 100);
            
            simulateDataUpdate();
            setInterval(simulateDataUpdate, 5000);
        });
    </script>
</body>
</html>
